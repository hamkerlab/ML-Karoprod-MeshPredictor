
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Usage - Mesh predictor</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.08040f6c.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#usage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Mesh predictor" class="md-header__button md-logo" aria-label="Mesh predictor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mesh predictor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Usage
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hamkerlab/ML-Karoprod-MeshPredictor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Mesh predictor" class="md-nav__button md-logo" aria-label="Mesh predictor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Mesh predictor
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hamkerlab/ML-Karoprod-MeshPredictor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../datapreparation/" class="md-nav__link">
        Data preparation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Usage
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#loading-the-data" class="md-nav__link">
    Loading the data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-the-network" class="md-nav__link">
    Training the network
  </a>
  
    <nav class="md-nav" aria-label="Training the network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autotuning" class="md-nav__link">
    Autotuning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-selection" class="md-nav__link">
    Manual selection
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-prediction" class="md-nav__link">
    Single prediction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interactive-visualization" class="md-nav__link">
    Interactive visualization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-a-pretrained-network" class="md-nav__link">
    Loading a pretrained network
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimization-of-the-process-parameters" class="md-nav__link">
    Optimization of the process parameters
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Predictor/" class="md-nav__link">
        Predictor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CutPredictor/" class="md-nav__link">
        CutPredictor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ProjectionPredictor/" class="md-nav__link">
        ProjectionPredictor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../MeshPredictor/" class="md-nav__link">
        MeshPredictor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../DoubleProjectionPredictor/" class="md-nav__link">
        DoubleProjectionPredictor
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Cut_x0/" class="md-nav__link">
        Cut x0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Cut_web/" class="md-nav__link">
        Cut web
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Cut_flange/" class="md-nav__link">
        Cut flange
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Projection_2D/" class="md-nav__link">
        Projection 2D
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Reference_3D/" class="md-nav__link">
        Reference 3D
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Springback_UV_xyz/" class="md-nav__link">
        Springback UV xyz
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Joining/" class="md-nav__link">
        Joining
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#loading-the-data" class="md-nav__link">
    Loading the data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-the-network" class="md-nav__link">
    Training the network
  </a>
  
    <nav class="md-nav" aria-label="Training the network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autotuning" class="md-nav__link">
    Autotuning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-selection" class="md-nav__link">
    Manual selection
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-prediction" class="md-nav__link">
    Single prediction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interactive-visualization" class="md-nav__link">
    Interactive visualization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-a-pretrained-network" class="md-nav__link">
    Loading a pretrained network
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimization-of-the-process-parameters" class="md-nav__link">
    Optimization of the process parameters
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/hamkerlab/ML-Karoprod-MeshPredictor/edit/master/docs/usage.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">#</a></h1>
<p>Three prediction objects are provided depending on the dimensionality of the input positions:</p>
<ol>
<li><code>CutPredictor</code> for 1D positions.</li>
<li><code>ProjectionPredictor</code> for 2D positions.</li>
<li><code>MeshPredictor</code> for 3D positions. </li>
</ol>
<p>They only differ for a few methods, such as <code>load_data()</code> and <code>predict()</code>. Most methods are common, so we focus here on the 1D case with <code>CutPredictor</code>.</p>
<h2 id="loading-the-data">Loading the data<a class="headerlink" href="#loading-the-data" title="Permanent link">#</a></h2>
<p>Once the data is loaded as pandas Dataframes, it can be passed to the <code>CutPredictor</code> object:</p>
<div class="highlight"><pre><span></span><code><span class="n">reg</span> <span class="o">=</span> <span class="n">CutPredictor</span><span class="p">()</span>

<span class="n">reg</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span>
    <span class="n">doe</span> <span class="o">=</span> <span class="n">doe</span><span class="p">,</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
    <span class="n">process_parameters</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Blechdicke&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Niederhalterkraft&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Ziehspalt&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Einlegeposition&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Ziehtiefe&#39;</span>
        <span class="s1">&#39;Stempel_ID&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">categorical</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Ziehspalt&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Einlegeposition&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Ziehtiefe&#39;</span>
        <span class="s1">&#39;Stempel_ID&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">position</span> <span class="o">=</span> <span class="s1">&#39;tp&#39;</span><span class="p">,</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;deviationc&#39;</span><span class="p">,</span>
    <span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;doe_id&#39;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>One has to specify among all the columns present in the frames which ones are to be used as process parameters, which one is the input position and which one(s) is the output. If several output variables should be predicted, a list of names should be given. The name of the column containing the experiment ID should be provided.</p>
<p>Optionally, one can specify which process parameter is categorical (as opposed to numerical), i.e. takes discrete values. This only influences the training of the neural network, as categorical attributes are then one-hot encoded before being passed to the NN. This is however optional.</p>
<p>When the data is loaded in the <code>CutPredictor</code>, it is normalized to allow for efficient training, so this can take a while depending on the size of your data.</p>
<h2 id="training-the-network">Training the network<a class="headerlink" href="#training-the-network" title="Permanent link">#</a></h2>
<p><code>CutPredictor</code> uses a feedforward neural network to perform the regression. It is a simple multi-layer perceptron with several layers of neuron, using the mean square error as a loss function. </p>
<p>The hyperparameters of the NN are:</p>
<ul>
<li>the number of layers and neurons.</li>
<li>the learning rate.</li>
<li>the dropout level for regularization.</li>
<li>the batch size.</li>
<li>the number of epochs</li>
</ul>
<p>It may be tricky to find the right hyperparameters for your data. Two methods are available: an automatic one using the <code>optuna</code> library and a manual one.</p>
<h3 id="autotuning">Autotuning<a class="headerlink" href="#autotuning" title="Permanent link">#</a></h3>
<p>The <code>autotune</code> method launches a Bayesian optimization procedure thanks to the <code>optuna</code> library to find the best set of hyperparameters for the data. In a nutshell, it will train <code>trials=100</code> different networks with hyperparameters sampled ffrom the specified ranges:</p>
<div class="highlight"><pre><span></span><code><span class="n">best_config</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">autotune</span><span class="p">(</span>
    <span class="n">save_path</span><span class="o">=</span><span class="s1">&#39;best_model&#39;</span><span class="p">,</span>
    <span class="n">trials</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">max_epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> 
    <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="n">neurons</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">64</span><span class="p">],</span>
    <span class="n">dropout</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>The networks have diffrent number of layers, neurons per layer, learning rates and so on. The network with the best validation accuracy is finally selected and saved in the <code>best_model/</code> directory. It can be used to make predictions.</p>
<p>The more trials you make, the more likely you will find a satisfying solution if the provided ranges are well chosen. But if the ranges are too wide, you will neeed many trials to find the optimal setup. The autotuning procedure can take a while depending on the number of trials, the size of the networks and the maximum number of epochs.</p>
<p>If you have multiple GPUs on the system, try to limit tensorflow training to one of them (e.g. GPU of id 0). If your code is in a script, use:</p>
<div class="highlight"><pre><span></span><code><span class="n">CUDA_VIDIBLE_DEVICES</span><span class="o">=</span><span class="mi">0</span> <span class="n">python</span> <span class="n">Script</span><span class="o">.</span><span class="n">py</span>
</code></pre></div>
<p>In a notebook, run that cell first:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUDA_DEVICE_ORDER&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PCI_BUS_ID&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUDA_VISIBLE_DEVICES&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
</code></pre></div>
<h3 id="manual-selection">Manual selection<a class="headerlink" href="#manual-selection" title="Permanent link">#</a></h3>
<p>If you prefer to do the optimization yourself, or fine-tune the architecture found by <code>autotune</code> by training it for more epochs, you can define the network using a dictionary:</p>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="mi">4096</span><span class="p">,</span>
    <span class="s1">&#39;max_epochs&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s1">&#39;layers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>
    <span class="s1">&#39;dropout&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.005</span>
<span class="p">}</span>
</code></pre></div>
<p>and train that model:</p>
<div class="highlight"><pre><span></span><code><span class="n">reg</span><span class="o">.</span><span class="n">custom_model</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="s1">&#39;best_model&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>The model's weights are saved in <code>best_model/</code>.</p>
<h2 id="single-prediction">Single prediction<a class="headerlink" href="#single-prediction" title="Permanent link">#</a></h2>
<p>To make a prediction for a (potentially new) set of process parameters, simply pass them as a dictionary to the <code>predict()</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">({</span>
        <span class="s1">&#39;Blechdicke&#39;</span><span class="p">:</span> <span class="mf">1.01</span><span class="p">,</span> 
        <span class="s1">&#39;Niederhalterkraft&#39;</span><span class="p">:</span> <span class="mf">410.0</span><span class="p">,</span> 
        <span class="s1">&#39;Ziehspalt&#39;</span><span class="p">:</span> <span class="mf">2.4</span><span class="p">,</span> 
        <span class="s1">&#39;Einlegeposition&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> 
        <span class="s1">&#39;Ziehtiefe&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s1">&#39;Stempel_ID&#39;</span><span class="p">:</span> <span class="mi">3</span>
    <span class="p">},</span> 
    <span class="n">positions</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</code></pre></div>
<p>This will return 1000 values of the position <code>x</code> as well as the corresponding predicted outputs <code>y</code> (shape (1000, d), where d is the number of output variables).</p>
<p>The <code>positions</code> argument depends on the class:</p>
<ul>
<li>For <code>CutPredictor</code>, it represents the number of points uniformly sampled between the min/max values of the position parameter.</li>
<li>For <code>ProjectionPredictor</code>, it must be a tuple (m, n) for the shape of the sampled 2D positions, uniformly between the min/max values of those parameters.</li>
<li>For <code>MeshPredictor</code>, it must be a (N, 3) numpy array of 3D coordinates for the N points where the prediction should be made.</li>
</ul>
<h2 id="interactive-visualization">Interactive visualization<a class="headerlink" href="#interactive-visualization" title="Permanent link">#</a></h2>
<p>In a Jupyter notebook, you can use the <code>interactive()</code> method to get sliders for the process parameters and interactively visualize the predictions.</p>
<p>You first need to define a visualization method:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">viz</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;tp&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;deviationc&#39;</span><span class="p">)</span>
</code></pre></div>
<p>and pass it to the method, together with the same <code>positions</code> argument as for the <code>predict()</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span> <span class="c1"># necessary in notebooks</span>
<span class="n">reg</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="n">viz</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../sliders.png" /></p>
<h2 id="loading-a-pretrained-network">Loading a pretrained network<a class="headerlink" href="#loading-a-pretrained-network" title="Permanent link">#</a></h2>
<p>Once a suitable model has been trained on the data and saved in 'best_model', it can be used for inference.</p>
<p>If you do not want the data to be loaded for the prediction, you should save the data-related parameters (min/max values of the attributes, etc) in a pickle file:</p>
<div class="highlight"><pre><span></span><code><span class="n">reg</span><span class="o">.</span><span class="n">save_config</span><span class="p">(</span><span class="s2">&quot;data.pkl&quot;</span><span class="p">)</span>
</code></pre></div>
<p>This way, you can recreate a <code>CutPredictor</code> object without loading the data in memory:</p>
<div class="highlight"><pre><span></span><code><span class="n">reg</span> <span class="o">=</span> <span class="n">CutPredictor</span><span class="p">()</span>
<span class="n">reg</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="s2">&quot;data.pkl&quot;</span><span class="p">)</span>
</code></pre></div>
<p>and finally load the weights of the trained model:</p>
<div class="highlight"><pre><span></span><code><span class="n">reg</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">load_path</span><span class="o">=</span><span class="s1">&#39;best_model&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Alternatively, you can save both the configuration and the trained network in a single HDF5 file:</p>
<div class="highlight"><pre><span></span><code><span class="n">reg</span><span class="o">.</span><span class="n">save_h5</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;best_model.h5&#39;</span><span class="p">)</span>
</code></pre></div>
<p>and create a regressor for inference using the class method <code>from_h5</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">reg</span> <span class="o">=</span> <span class="n">CutPredictor</span><span class="o">.</span><span class="n">from_h5</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;best_model.h5&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="optimization-of-the-process-parameters">Optimization of the process parameters<a class="headerlink" href="#optimization-of-the-process-parameters" title="Permanent link">#</a></h2>
<p>Once a model is trained or loaded, it can be used to predict which value of the process parameters minimize a user-defined criterion.</p>
<p>For example, if you want to minimize the average deviation over the 1D cut, you can define the following function:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">mean_deviation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>
<p>where <code>x</code> are the sampled input positions (useful if you want to restrict the objective function to a particular part of the input space) and <code>y</code> is a numpy array containing the predicted values for each output variable.</p>
<p>You can then pass this function to <code>optimize()</code>, which will sample the process parameters using Bayesian optimization (optuna) to find out the values that minimize the obective:</p>
<div class="highlight"><pre><span></span><code><span class="n">params</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">mean_deviation</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nb_trials</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</code></pre></div>
<p>The <code>positions</code> should have the same meaning as for the <code>predict()</code> method, depending on the actual class. </p>
<p><code>nb_trials</code> specifies how many predictions will be made, the more the better.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../datapreparation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Data preparation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Data preparation
            </div>
          </div>
        </a>
      
      
        
        <a href="../Predictor/" class="md-footer__link md-footer__link--next" aria-label="Next: Predictor" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Predictor
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Aida Farahani, Payam Atoofi, Julien Vitay
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>